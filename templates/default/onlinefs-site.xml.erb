<?xml version="1.0" encoding="UTF-8"?>
<onlinefs>
  <service>
    <threadNumber><%= node['onlinefs']['service']['thread_number'] %></threadNumber>
    <getSessionRetrySleepMs><%= node['onlinefs']['service']['get_session_retry_sleep_ms'] %></getSessionRetrySleepMs>
    <maxBlacklistSize><%= node['onlinefs']['service']['max_blacklist_size'] %></maxBlacklistSize>
  </service>

  <rondb>
    <connectionString><%= @mgm_fqdn %>:<%= node['ndb']['mgmd']['port'] %></connectionString>
    <batchSize><%= node['onlinefs']['rondb']['batch_size'] %></batchSize>
    <poolSize><%= node['onlinefs']['rondb']['pool_size'] %></poolSize>
    <maxCachedSessions><%= node['onlinefs']['rondb']['max_cached_sessions'] %></maxCachedSessions>
    <maxCachedInstances><%= node['onlinefs']['rondb']['max_cached_instances'] %></maxCachedInstances>
    <reconnectTimeout><%= node['onlinefs']['rondb']['reconnect_timeout'] %></reconnectTimeout>
    <maxTransactions><%= node['onlinefs']['rondb']['max_transactions'] %></maxTransactions>
    <useSessionCache><%= node['onlinefs']['rondb']['use_session_cache'] %></useSessionCache>
    <useDynamicObjectCache><%= node['onlinefs']['rondb']['use_dynamic_object_cache'] %></useDynamicObjectCache>
  </rondb>
  
  <kafkaConfig>
    <bootstrap.servers><%= @kafka_fqdn %>:<%= node['kkafka']['broker']['port'] %</bootstrap.servers>
    <security.protocol>SSL</security.protocol>
    <ssl.truststore.location>/certs/<%= node['onlinefs']['user'] %>__tstore.jks</ssl.truststore.location>
    <ssl.truststore.password>adminpw</ssl.truststore.password>
    <ssl.keystore.location>/certs/<%= node['onlinefs']['user'] %>__kstore.jks</ssl.keystore.location>
    <ssl.keystore.password>adminpw</ssl.keystore.password>
    <ssl.key.password>adminpw</ssl.key.password>
    <ssl.endpoint.identification.algorithm></ssl.endpoint.identification.algorithm>
    <group.id>0</group.id>
    <auto.offset.reset>earliest</auto.offset.reset>
    <metadata.max.age.ms>60000</metadata.max.age.ms>
    <max.partition.fetch.bytes>1048576</max.partition.fetch.bytes>
    <max.poll.records>1000</max.poll.records>
    <enable.auto.commit>false</enable.auto.commit>
  </kafkaConfig>

  <kafkaConsumer>
    <topicPattern>.*_onlinefs</topicPattern>
    <pollTimeoutMs>1000</pollTimeoutMs>
  </kafkaConsumer>

  <hopsworks>
    <trustStoreLocation>/certs/<%= node['onlinefs']['user'] %>__tstore.jks</trustStoreLocation>
    <tokenLocation>/onlinefs/etc/token</tokenLocation>
    <url><%= @hopsworks_url %></url>
  </hopsworks>

  <metrics>
    <port><%= node['onlinefs']['monitoring'] %></port>
  </metrics>

</onlinefs>
